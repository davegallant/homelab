set positional-arguments

# Sets up ansible
setup:
	ansible-galaxy collection install -r requirements.yml

# Run ansible-playbook
run argument:
	ansible-playbook playbooks/main.yml -i inventory {{argument}} --vault-password-file .vault_pass

# Run all playbooks in parallel
run-parallel:
	#!/bin/sh
	playbooks=$(find playbooks -maxdepth 1 -type d -not -name playbooks | sed 's|playbooks/||' | sort)
	for playbook in $playbooks; do
		ansible-playbook playbooks/$playbook/main.yml -i inventory --vault-password-file .vault_pass &
	done
	wait
	echo "All playbooks completed"
