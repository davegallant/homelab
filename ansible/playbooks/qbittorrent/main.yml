---
- name: Install qbittorrent
  hosts: qbittorrent
  tasks:
    - ansible.builtin.include_tasks:
        file: ../../tasks/install-docker.yml

    - ansible.builtin.include_tasks:
        file: ../../tasks/install-common-packages.yml

    - ansible.builtin.include_tasks:
        file: ../../tasks/install-alloy.yml

    - name: Copy docker-compose.yml
      ansible.builtin.template:
        src: docker-compose.yml
        dest: "~/docker-compose.yml"
        mode: "0640"

    - name: Create 'qBittorrent' directory
      ansible.builtin.file:
        path: "~/qBittorrent"
        state: directory

    - name: Copy qbittorrent.conf
      ansible.builtin.template:
        src: ./qbittorrent.conf
        dest: "~/qBittorrent/qBittorrent.conf"
        mode: "0640"

    - name: Enable UFW
      community.general.ufw:
        state: enabled
        policy: deny

    - ansible.builtin.include_tasks:
        file: ../../tasks/docker-pull.yml
